<databaseChangeLog
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
   http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd">

    <changeSet author="JuliaSzymanska" id="2022-10-27-01" runOnChange="true" context="dev_local">
        <sql>
--                 do '
                    Create function create_tablemetadata(table_name varchar(64))
                    RETURNS void
                    DECLARE row_num int; DECLARE account_id BIGINT; DECLARE table_metadata_id BIGINT;
                    BEGIN
                        EXECUTE format(&apos;&apos;SELECT (select max(id) from %I) into account_id&apos;&apos;, table_name);
                        EXECUTE format(&apos;&apos;SELECT (select Count(*) from %I) into row_num&apos;&apos;, table_name);
                        WHILE row_num > 0 LOOP
                            SELECT nextval(&apos;&apos;table_metadata_sequence&apos;&apos;) INTO table_metadata_id;
                            INSERT INTO table_metadata (id, version) VALUES (table_metadata_id, 0);
                            EXECUTE format(&apos;&apos;UPDATE %I SET table_metadata_id = table_metadata_id WHERE id = account_id;&apos;&apos;, table_name);
                            EXECUTE format(&apos;&apos;SELECT (select id from %I where (id  &lt; account_id) order by id desc LIMIT 1) into account_idEXECUTE format(&apos;&apos;, table_name);
                            SELECT row_num - 1 into row_num;
                        END LOOP;
                        RETURN;
                    END;
--                 '
        </sql>
    </changeSet>
</databaseChangeLog>